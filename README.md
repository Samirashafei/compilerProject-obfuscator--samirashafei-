# compilerProject-obfuscator--samirashafei-

ุงุนุถุง ฺฏุฑูู 
ูพุฑูุงู ุจูุฑุงู 
ุณูุฑุง ุดูุน 

```markdown
# MiniC Obfuscator

ุณุงุฎุชุงุฑ ูพุฑูฺู :
MiniC-Obfuscator/
โโโ MiniCLexer.py
โโโ MiniCParser.py
โโโ ObfuscatorVisitor.py
โโโ obfuscator.py
โโโ test.c
โโโ README.md
# ุงุจุฒุงุฑ ูพุฑูฺู
- antlr 
- python
- graphiz
- argparse
- random

# ๐๏ธ ุฑููุฏ ุงุฌุฑุง ูพุฑูฺู MiniC Obfuscator

## ูุฑุงุญู ูพุดโูพุฑุฏุงุฒุด ูุจู ุงุฒ ุงุนูุงู ุชฺฉูฺฉโูุง ูุจููโุณุงุฒ

ูุจู ุงุฒ ุดุฑูุน ูุฑุขูุฏ Obfuscationุ ูุงุฒู ุงุณุช ฺฉ ุณุฑ ูุฑุงุญู ุงููู ุฑู ฺฉุฏ ููุจุน ุงูุฌุงู ุดููุฏ. ุงู ูุฑุงุญู ุฏุฑ ูุงู `test.py` ูพุงุฏูโุณุงุฒ ุดุฏูโุงูุฏ ู ุดุงูู ููุงุฑุฏ ุฒุฑ ูุณุชูุฏ:

### ๐น ูุฑุญูู ฑ: ุฎูุงูุฏู ูุงู ููุจุน
ุงุจุชุฏุง ูุงู ฺฉุฏ ููุจุน ุจุง ูพุณููุฏ `.mc` (ูุซูุงู `input.mc`) ุฎูุงูุฏู ูโุดูุฏ.

### ๐น ูุฑุญูู ฒ: ุชุญูู ูุงฺฺฏุงู (Lexer)
ุจุง ุงุณุชูุงุฏู ุงุฒ ูุงู ฺฏุฑุงูุฑ `MiniC.g4` ฺฉู ุชูุณุท ANTLR ุชุนุฑู ุดุฏูุ ูุงูโูุง ูพุงุชูู ูุงููุฏ `MiniCLexer.py` ุชููุฏ ูโุดููุฏ.

ุฏุฑ ุงู ูุฑุญููุ ฺฉููุงุช ฺฉูุฏ ูุงููุฏ `return`ุ ุดูุงุณูโูุงุ ุนููฺฏุฑูุง ู ... ุชูุณุท Lexer ุจู **ุชูฺฉู**โูุง ูุงุจู ููู ุจุฑุง ูุฑุญูู ุจุนุฏ ุชุจุฏู ูโุดููุฏ.

### ๐น ูุฑุญูู ณ: ุชุญูู ูุญู (Parser)
ุชูฺฉูโูุง ุชููุฏุดุฏู ุชูุณุท Lexer ุจู Parser ุฏุงุฏู ูโุดููุฏ ุชุง **ุฏุฑุฎุช ูุญู (Parse Tree)** ุจุฑ ุงุณุงุณ ุณุงุฎุชุงุฑ ฺฏุฑุงูุฑ ุฒุจุงู MiniC ุณุงุฎุชู ุดูุฏ.

### ๐น ูุฑุญูู ด: ููุงุด ุฏุฑุฎุช ูุญู
ุฏุฑุฎุช ูุญู ุชููุฏุดุฏู ุฏุฑ ุชุฑููุงู ุจูโุตูุฑุช ูุชู ููุงุด ุฏุงุฏู ูโุดูุฏ.

### ๐น ูุฑุญูู ต: ุชููุฏ ููุงุด ฺฏุฑุงูฺฉ ุฏุฑุฎุช
ุจุฑุง ููุงุด ุจุตุฑ ุฏุฑุฎุช ูุญู:
- ุงุฒ ูุฑูโุงูุฒุงุฑ **Graphviz** ุงุณุชูุงุฏู ูโฺฉูู.
- ุงุจุชุฏุง ููุงุด ูุชู ุฏุฑุฎุช ุฑุง ุฏุฑ ูุงูุจ ูุงู `.dot` ุฐุฎุฑู ูโฺฉูู.
- ุณูพุณ ุจุง ุงุณุชูุงุฏู ุงุฒ Graphvizุ ูุงู `.dot` ุฑุง ุจู ูุฑูุช ุชุตูุฑ ูุงููุฏ `.png` ุง `.pdf` ุชุจุฏู ูโฺฉูู.
- ฺฉุฏ ุจุฑุง ุชุจุฏู ููุงุด ูุชู ุจู `.dot` ุฏุฑ ูุงู `test.py` ููุดุชู ุดุฏู ุงุณุช.

---
## ๐ฏ ุดุฑูุน ูุฑุขูุฏ ูุจููโุณุงุฒ (Obfuscation)

ุฏุฑ ุจุฎุด ุฏูู ูพุฑูฺูุ ุจุง ุงุณุชูุงุฏู ุงุฒ ุณู ุชฺฉูฺฉ ุฑุงุฌุ ฺฉุฏ ููุจุน ุฑุง ูุจูู ูโฺฉูู:

### โ ุชฺฉูฺฉ ุงูู: ุชุบุฑ ูุงู ุดูุงุณูโูุง (Identifiers)
- ุฏุฑ ูุงู `ObfuscatorVisitor.py`ุ ฺฉูุงุณ ุจู ูุงู `ObfuscatorVisitor` ุชุนุฑู ุดุฏู ฺฉู ุงุฒ ฺฉูุงุณ ูพุงู `MiniCVisitor` ุงุฑุซโุจุฑ ูโฺฉูุฏ.
- ุฏุฑ ุงู ฺฉูุงุณุ ูฺฉุงูโูุง ุงุฒ ฺฉุฏ ฺฉู ุดูุงุณูโูุง (ูุงู ุชูุงุจุนุ ูุชุบุฑูุง ู ...) ุงุณุชูุงุฏู ุดุฏูโุงูุฏ ุดูุงุณุง ูโุดููุฏ.
- ุจุฑุง ูุฑ ุดูุงุณูุ ฺฉ ูุงู ุชุตุงุฏู ุง ูุดุฎุต ุฌุงฺฏุฒู ูโุดูุฏ ู ุงู ุชุบุฑ ุฏุฑ ุณุฑุงุณุฑ ฺฉุฏ ุงุนูุงู ูโฺฏุฑุฏุฏ.
-  ูฺฏุงุดุช ุจูโุตูุฑุช ุฏฺฉุดูุฑ ุงุฒ ูุงูโูุง ุงุตู ุจู ูุงูโูุง ุฌุฏุฏ ูฺฏูโุฏุงุฑ ูโุดูุฏ ุชุง ุงูุณุฌุงู ุญูุธ ุดูุฏ.ู
- ุงุฒ ุงู ุฏุฑ ูุฑุงุญู ุฏฺฏุฑ ูุซู ุชุงุจุน ุฌุงฺฏุฒู ุนุจุงุฑุงุช ุงุณุชูุงุฏู ูุงุฒู ุฑุง ุจฺฉูู 
##  ุชฺฉูฺฉ ุจุงุฒููุณ ุนุจุงุฑุงุช (Expression Replacement)
ุงู ุชุบุฑุงุช ุจุงุนุซ ุณุฎุชโ ููู ุดุฏู ููุทู ฺฉุฏ ุจุฑุง ุงูุฑุงุฏ ุบุฑูุฌุงุฒ ูโุดููุฏ.

ุจุฑุง ุงู ฺฉุงุฑุ ุฏุฑ ูุงู `obfuscate_to_file.py` ุชุงุจุน ุจู ูุงู `replace_expression_pattern` ูพุงุฏูโุณุงุฒ ฺฉุฑุฏู.

### โ๏ธ ูุฑูุฏโูุง ุชุงุจุน:

- `tokens`: ูุณุช ุงุฒ ุชูฺฉูโูุง
- `i`: ุงูุฏุณ ุดุฑูุน ุจุฑุฑุณ
- `name_map`: ูฺฏุงุดุช ุจุฑุง ุฌุงฺฏุฒู ูุงูโูุง ูุชุบุฑูุง

### ๐งช ูุฑุงุญู ุงุฌุฑุง:

1. ุงุจุชุฏุง ุจุฑุฑุณ ูโุดูุฏ ฺฉู ุขุง ุญุฏุงูู ณ ุชูฺฉู ุจุนุฏ ุงุฒ ุงูุฏุณ ูุนู ูุฌูุฏ ุฏุงุฑุฏ ุง ูู.
   - ุงฺฏุฑ ฺฉูุชุฑ ุจุงุดุฏุ ุชุงุจุน ุจุง ุฎุฑูุฌ `None` ู ูพุดุฑู ฺฉโ ฺฏุงู (`1`) ูพุงุงู ูโุงุจุฏ.

2. ุงฺฏุฑ ุงูฺฏู ุณูโุชุง ุฒุฑ ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ:
- `Operand1` ู `Operand2` ุจุงุฏ ุงุฒ ููุน `Identifier` ุง `IntegerConstant` ุจุงุดูุฏ.
- `Operator` ูโุชูุงูุฏ ฺฉ ุงุฒ ุนููฺฏุฑูุง `+`, `-`, `*`, `/`, `==`, `&&`, `||` ุจุงุดุฏ.

3. ุงฺฏุฑ ุดูุงุณูโุง ุฏุฑ `name_map` ุจุงุดุฏุ ุจุง ูุงู ุฌุฏุฏุด ุฌุงฺฏุฒู ูโุดูุฏ.

4. ุณูพุณ ุนููฺฏุฑ ุจุฑุฑุณ ุดุฏู ู ุจุณุชู ุจู ููุน ุขูุ ุนุจุงุฑุช ุจุงุฒููุณ ูโุดูุฏ:
- `a + b` โ `a - (-b)`
- `a - b` โ `a + (-b)`
- `a * 2` โ `a << 1`
- `a / 2` โ `a >> 1`
- `a == b` โ `! (a != b)`
- `a && b` โ `!(!a || !b)`
- `a || b` โ `!(!a && !b)`

ุฏุฑ ุงู ุฑูุดุ ุฏุฑ ุญุงู ฺฉู ูุชุฌูโ ููุทู ุชุบุฑ ููโฺฉูุฏุ ฺฉุฏ ูพฺุฏูโุชุฑ ุดุฏู ู ููู ุขู ุจุฑุง ุงูุฑุงุฏ ุบุฑูุฌุงุฒ ุณุฎุชโุชุฑ ูโุดูุฏ.
---
### โ ุชฺฉูฺฉ ุณูู: ุฏุฑุฌ ฺฉุฏ ูุฑุฏู (Dead Code Insertion)

- ฺฉุฏูุง ฺฉู ูฺโฺฏุงู ุงุฌุฑุง ููโุดููุฏ ุจูโุตูุฑุช ุชุตุงุฏู ุฏุฑ ุจูุงฺฉโูุง ุงุถุงูู ูโุดููุฏ.

- ูุซุงูโูุง:
  - `if (0) { printf("This won't run"); }`
  - ุชุนุฑู ูุชุบุฑูุง ุจุฏูู ุงุณุชูุงุฏู ูุงููุฏ `int dead = 1234;`

- ุงู ุชฺฉูฺฉ ุฎูุงูุง ฺฉุฏ ุฑุง ฺฉุงูุด ูโุฏูุฏ ูู ุนููฺฉุฑุฏ ุขู ุฑุง ุชุบุฑ ููโุฏูุฏ.

- ุงูู ฺฉ ุณุฑ ฺฉุฏ ฺฉู ุฑู ุฎุฑูุฌ ุจุฑูุงูู ุงุตู ุชุงุซุฑ ูุฏุงุฑูุฏ ุฏุฑ ฺฉ ุชุงุจุน `get_random_dead_code()` ุชุนุฑู ูฺฉูู.

- ฺฉุฏ ูุฑุฏู ุฑุง ุฏุฑ ููุงุท ุงุฒ ฺฉุฏ ุงุตู ูุญุงุธ ูฺฉูู:
  - ุฏุฑ ุดุฑูุน ฺฉ ุจูุงฺฉ ฺฉุฏ ุนู ุจุนุฏ ุงุฒ `{`
  - ุจุนุฏ ุงุฒ ูพุงุงู ุฏุณุชูุฑ ุจุง ุงุญุชูุงู 30 ุฏุฑุตุฏ ฺฉ ฺฉุฏ ูุฑุฏู ุงุถุงูู ูฺฉูู

### ๐๏ธ ุจุฎุด ุงูุชุงุฒ: ุงุณุชูุงุฏู ุงุฒ CLI ุจุฑุง ุงุฌุฑุง ูพุฑูฺู

ุจุฑุง ุงูฺฉู ุจุชูุงูู ุจุง ุฒุฏู ุฏุณุชูุฑ ุฏุฑ ุฎุท ูุฑูุงูุ ูพุฑูฺู ุฑุง ุงุฌุฑุง ฺฉูู:

- ุงุจุชุฏุง ุจุงุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ `import argparse` ุฏุฑ ูุงู ุงุตู (main) ุชุนุฑูโูุง ูุงุฒู ุฑุง ุงูุฌุงู ุฏูู ุชุง ุฎุท ูุฑูุงู ุฑุง ูพุฑุฏุงุฒุด ฺฉูุฏ.

- ุขุฑฺฏููุงูโูุง ูุฑูุฏ ุฏุฑ ุฎุท ูุฑูุงู ุจู ุดฺฉู ุฒุฑ ุชุนุฑู ูโุดููุฏ:

  - `--input` : ุจุนุฏ ุงุฒ ุงู ฺฏุฒููุ ูุงู ูุงู ูุฑูุฏ ูุฑุงุฑ ูโฺฏุฑุฏ.
  - `--output` : ุจุนุฏ ุงุฒ ุงู ฺฏุฒููุ ูุงู ูุงู ุฎุฑูุฌ ูุดุฎุต ูโุดูุฏ.
  - `--techniques` : ูุณุช ุชฺฉูฺฉโูุง ูุจููโุณุงุฒ ฺฉู ูโุฎูุงูู ุงุนูุงู ุดููุฏ.

- ุชฺฉูฺฉโูุง ฺฉู ุจูโุตูุฑุช ุฑุดุชู ูุณุชูุฏุ ุจุงุฏ ุจู ูุณุช ุชุจุฏู ุดููุฏ ุชุง ุจุชูุงู ุฑู ุขูโูุง ูพุฑุฏุงุฒุด ุงูุฌุงู ุฏุงุฏ.

- ุฏุฑ ููุงุช ุชุงุจุน `obfuscate_and_save` ุฑุง ุจุงุฒููุณ ูโฺฉูู ุชุง:
  - ูพุงุฑุงูุชุฑูุง ูุฑูุฏ ู ุฎุฑูุฌ ุฑุง ุจู ุตูุฑุช ุขุฑฺฏููุงู ุฏุฑุงูุช ฺฉูุฏ.
  - ุชฺฉูฺฉโูุง ุงูุชุฎุงุจโุดุฏู ุฑุง ุจุฑุฑุณ ฺฉุฑุฏู ู ููุทู ุงุฌุฑุง ุฑุง ุจุฑ ุงุณุงุณ ุขูโูุง ฺฉูุชุฑู ฺฉูุฏ.
  
# struct ู pointer ูพุดุชุจุงู
ฺฏุฑุงูุฑ ุฒุจุงู ุชุนุฑูโ ุดุฏู ุฏุฑ ูุงู MiniC.g4 ุจูโฺฏูููโุง ุทุฑุงุญ ุดุฏู ุงุณุช ฺฉู ุงุฒ ุณุงุฎุชุงุฑูุง struct ู ุงุดุงุฑูโฺฏุฑูุง (pointer) ูพุดุชุจุงู ฺฉุงูู ุฏุงุฑุฏ.

# โ ุชุณุช ุนูู
ุจุฑุง ุจุฑุฑุณ ุนููฺฉุฑุฏ ุงู ูฺฺฏโูุงุ ูุงู ุจุง ูุงู testsp.mc ุงุฌุงุฏ ุดุฏ ฺฉู ุฏุฑ ุขู ุงุฒ struct ู pointer ุงุณุชูุงุฏู ุดุฏู ุงุณุช. ูพุณ ุงุฒ ุงุฌุฑุง ุจุฑูุงูู ู ูุดุงูุฏู ุฎุฑูุฌ ุจุฏูู ุจุฑูุฒ ุฎุทุงุ ุตุญุช ุนููฺฉุฑุฏ ฺฏุฑุงูุฑ ุฏุฑ ุงู ููุงุฑุฏ ุชุฃุฏ ุดุฏ.
# ุชุนุฑู  struct 
ุฏุฑ ฺฏุฑุงูุฑุ ููุน struct ุฏุฑ ูุงุนุฏูโ typeSpecifier ูุดุฎุต ุดุฏู ู ููฺูู ูุงุนุฏูโุง ูุฌุฒุง ุจุฑุง ุชุนุฑู ุณุงุฎุชุงุฑ ุจุง ุนููุงู structDefinition ุฏุฑ ูุธุฑ ฺฏุฑูุชู ุดุฏู ุงุณุช
# ุชุนุฑู pointer
ูพุดุชุจุงู ุงุฒ ุงุดุงุฑูโฺฏุฑูุง ุงุฒ ุทุฑู ูุงุนุฏูโ pointerSpecifier ุงูุฌุงู ุดุฏู ู ุฏุฑ ูฺฉุงูโูุง ูุงููุฏ declaration ู parameter ุจูโฺฉุงุฑ ุฑูุชู ุงุณุช
# ุฏุณุชุฑุณ ุจู ุงุนุถุง struct ู pointer
ุฏุณุชุฑุณ ุจู ุงุนุถุง ฺฉ struct ุง ุงุดุงุฑูโฺฏุฑ ุจู struct ุงุฒ ุทุฑู ูุงุนุฏูโ postfixExpression ุฏุฑ ฺฏุฑุงูุฑ ูพุดุชุจุงู ูโุดูุฏ
ุจูุงุจุฑุงูุ ุฏู ุญุงูุช ุฒุฑ ุฏุฑ ุฒุจุงู ูุงุจู ุงุณุชูุงุฏู ูุณุชูุฏ
p.name ุจุฑุง ุฏุณุชุฑุณ ุจู ุงุนุถุง ฺฉ struct ูุนููู
p->name ุจุฑุง ุฏุณุชุฑุณ ุจู ุงุนุถุง ุณุงุฎุชุงุฑ ุงุฒ ุทุฑู ุงุดุงุฑูโฺฏุฑ ุจู struct



## ๐พ ูุชุฌู ููุง
ุฏุฑ ูพุงุงู ุงุฌุฑุง ุงุจุฒุงุฑ:
- ฺฉุฏ ุชููุฏ ูโุดูุฏ ฺฉู ุนููฺฉุฑุฏุด ุญูุธ ุดุฏู ุงูุง ุณุงุฎุชุงุฑุด ุชุบุฑ ุงูุชู ุงุณุช.
- ุฎุฑูุฌ ููุง ุฏุฑ ูุงู ูุดุฎุตโุดุฏู (ูุซูุงู `output.c`) ุฐุฎุฑู ูโุดูุฏ.
- ูพุงู ููููุช ุฏุฑ ุชุฑููุงู ฺุงูพ ูโุดูุฏ.

## ูุญูู ุงุฌุฑุง

```bash
python obfuscator.py --input test.c --output out.c --techniques rename,deadcode,expr
